## ⚙️ WSUS Management Tools

### 📝 Overview

The **WSUS Management Tools** repository provides a curated set of **PowerShell scripts** for automating, maintaining, and optimizing Windows Server Update Services (WSUS) and its underlying **SUSDB (Windows Internal Database)**. These tools are tailored for Active Directory environments and support both standalone and enterprise deployments.

### ✅ Key Features

- **Graphical Interface**: User-friendly GUI for WSUS administrators to execute routine tasks without using the command line  
- **Index Optimization**: Automatically generates SQL reindex scripts for fragmented WSUS database indexes  
- **Assembly Detection**: Verifies whether WSUS Admin assemblies are correctly loaded from the Global Assembly Cache (GAC)  
- **Centralized Logging**: Structured `.log` and `.csv` outputs for documentation and audit purposes  
- **Modular Design**: Scripts are standalone and can be used independently or scheduled for automation

---

## 🛠️ Prerequisites

1. **⚙️ PowerShell**  
   - Requires PowerShell version 5.1 or later  
   - To verify:
     ```powershell
     $PSVersionTable.PSVersion
     ```

2. **🔑 Administrator Privileges**  
   Scripts must be run with elevated privileges to access WSUS APIs and SUSDB functions

3. **📦 Required Modules**  
   - `UpdateServices` – installed with the WSUS Administration Console  
   - `ActiveDirectory` – optional, used for WSUS server discovery in the forest

4. **🗃 SQLCMD Tools**  
   - Required for executing SQL queries against the SUSDB using named pipes  
   - Ensure `sqlcmd.exe` is in the system PATH or manually defined

5. **🔧 Execution Policy**
   ```powershell
   Set-ExecutionPolicy -Scope Process -ExecutionPolicy RemoteSigned
   ```

6. **📂 SQL Script Files**  
   - **C:\Scripts\wsus-reindex.sql** (generated by **Generate-WSUSReindexScript.ps1**)  
   - **C:\Scripts\wsus-verify-fragmentation.sql**

   **Important**: When using the SUSDB Maintenance Tasks for *Check Index Fragmentation* and *Rebuild Indexes* in **Maintenance-WSUS-Admin-Tool.ps1**, copy these files to `C:\Logs-TEMP\WSUS-GUI\Scripts`.

7. **🧩 WSUS Admin Assembly**  
   Ensure `Microsoft.UpdateServices.Administration.dll` is registered in the GAC  
   Use **Check-WSUS-AdminAssembly.ps1** to validate the assembly presence and load status

---

## 📜 Script Descriptions (Alphabetical Order)

| **Script Name**                     | **Function**                                                                 |
|-------------------------------------|------------------------------------------------------------------------------|
| **Check-WSUS-AdminAssembly.ps1**    | Checks if `Microsoft.UpdateServices.Administration.dll` is loaded from GAC; prompts to install WSUS Console if missing |
| **Generate-WSUSReindexScript.ps1**  | Generates `wsus-reindex.sql` based on fragmentation and page thresholds using SQLCMD |
| **Maintenance-WSUS-Admin-Tool.ps1** | Performs WSUS cleanup, checkdb, shrink, reindex, and exports declined updates to CSV |

---

## 🚀 Usage Instructions

1. **Run the Script**: Right-click the desired `.ps1` file and select _Run with PowerShell_ as Administrator  
2. **Select Maintenance Options**: Use GUI checkboxes or configure parameters in the script  
3. **Check Logs**: Logs are saved in `$env:ProgramData\WSUS-GUI\Logs` or custom path

---

## 📁 Complementary Files

- **wsus-reindex-smart.sql**: Example SQL script created by **Generate-WSUSReindexScript.ps1**  
- **wsus-verify-fragmentation.sql**: SQL query for analyzing index fragmentation in SUSDB

---

## 💡 Optimization Tips

- **Leverage GPO Scheduling**: Automate maintenance using Task Scheduler or GPO-based scripts  
- **Centralize Logging**: Update `$logDir` in scripts to store logs on a network share  
- **Adapt Paths Per Environment**: Customize variables like `$sqlcmd`, `$namedPipe`, and folder paths  
- **Use Staging First**: Test WSUS maintenance tasks in a lab before production
- 
