name: VBScript Syntax Check

on:
  push:
    branches: [main, develop]
    paths:
      - '**/*.vbs'
      - '**/*.hta'
  pull_request:
    branches: [main, develop]
    paths:
      - '**/*.vbs'
      - '**/*.hta'
  workflow_dispatch:

jobs:
  vbscript-lint:
    name: VBScript Syntax Validation
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout Repository (short path to avoid path errors)
        uses: actions/checkout@v4
        with:
          path: repo

      - name: üîç Locate VBS and HTA Files
        working-directory: ./repo
        run: |
          find . -type f \( -iname "*.vbs" -o -iname "*.hta" \) > vbscript-files.txt
          cat vbscript-files.txt || echo "No .vbs or .hta files found."

      - name: ‚úÖ Heuristic Content Check
        working-directory: ./repo
        run: |
          while IFS= read -r file; do
            echo "üîç Checking: $file"
            if file "$file" | grep -qi "text"; then
              head -n 5 "$file"
            else
              echo "::warning file=$file::Not a valid text-based VBS or HTA file."
            fi
          done < vbscript-files.txt
